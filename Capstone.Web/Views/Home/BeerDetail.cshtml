@using Capstone.Web.Models
@model Beer
<div class="center jumbotron">
    <h2 style="text-align:center">@Model.BreweryName</h2>
    <div class="center" style="text-align:center">
        <h3 style="text-align:center">@Model.Name</h3>
        <br />
        <img src="~/Photos/@Model.Image" style="width:300px; border:1px solid black" />
        <br />
        <div style="text-align:center">
            <h4 style="text-align:center">@Model.BeerType</h4>
            @Model.Description
        </div>
        <div style="text-align:center">
            <strong>ABV: @Model.AlcoholByVolume</strong>
        </div>
    </div>
</div>




@*-----------------------------THE BEER REVIEW FORM-------------------------------*@

@*Users cannot view this review box unless they are registered*@

<input hidden id="viewBeerId" value="@Model.BeerID" />

@if (Session["UserId"] != null)
{
    int userId = (int)Session["UserId"];

    <div style="height: 200px; width:200px; background-color: lightgray; margin-left: 10px">
        <div id="form-messages"></div>

        <div class="field">
            <label for="rating">Rating:</label>
            <input type="number" id="rating" name="rating" required>
        </div>

        <div class="field">
            <label for="review">Review:</label>
            <input type="text" id="review" name="review" required>
        </div>

        <input hidden id="userId" name="userId" value="@userId" />
        <input hidden id="beerId" name="beerId" value="@Model.BeerID" />
        <input hidden id="date" name="date" value="@DateTime.Now" />

        <div class="field">
            <button id="submitreview" type="submit" style="margin-left: 25%">Submit Review</button>
        </div>
    </div>
}


@*-------------------------THIS IS THE LIST OF REVIEWS-------------------------------*@

@*<div>
    <table class="table table-striped" id="resultsTable" style="display: none; color: white">
        <thead>
            <tr>
                <th>Username</th>
                <th>Rating</th>
                <th>Review</th>
                <th>Date Posted</th>
            </tr>
        </thead>
        <tbody id="results"></tbody>
    </table>
</div>*@


@*-------------------------------LET'S TRY SOME CARDS----------------------------------*@

<div id="cardSpace" style="display: none; color: white"></div>




<script>

    //-----------------------------POST A NEW REVIEW--------------------------
    $(function () {
        $("#submitreview").click(function (event) {
            var rating = $("#rating").val();
            var review = $("#review").val();
            var userId = $("#userId").val();
            var beerId = $("#beerId").val();
            var date = $("#date").val();
            console.log(userId);
            console.log(beerId);
            console.log(date);
            console.log(rating);
            console.log(review);

            $.ajax({
                url: `/Home/ReviewBeer?rating=${rating}&review=${review}&userId=${userId}&beerId=${beerId}&date=${date}`,
                method: "POST",
                dataType: "json",
                success: function (data) {
                    window.location.href = "/Home/BeerDetail";

                }
            })

        })
    })

    //--------------------------GET REVIEWS FROM DB----------------------------

    $(function () {
        var beerId = $("#viewBeerId").val();
        $.ajax({
            url: `/Home/GetReviewsForBeer?beerId=${beerId}`,
            method: "GET",
            dataType: "json"
        }).done(function (result) {
            console.log(result);

            var list = result;

            //Display the returned reviews
            for (var i = 0; i < list.length; i++) {

                var r = list[i];

                var reviewDate = new Date(parseInt(r.Date.replace("/Date(", "").replace(")/", ""), 10));

                //var html = $(`<tr><td>${r.Username}</td><td>${r.Rating}</td><td>${r.ReviewPost}</td><td>${reviewDate.getMonth()}/${reviewDate.getDay()}/${reviewDate.getFullYear()}</td >`);
               var html = $(`<div class="card-body"><h5 class="card-title">${r.Rating}</h5><p class="card-text">${r.Username}</p><p class="card-text">${r.ReviewPost}</p><p class="card-text">${reviewDate.getMonth()}/${reviewDate.getDay()}/${reviewDate.getFullYear()}</p></div>`)
               // var html = $(`<div><h5>${r.Rating}</h5><p>${r.Username}</p><p>${r.ReviewPost}</p><p>${reviewDate.getMonth()}/${reviewDate.getDay()}/${reviewDate.getFullYear()}</p></div>`)

                $("#cardSpace").append(html);
            }
            $("#cardSpace").show();
        })

    })

    
</script>
